<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Framed loconote</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <script src='../loconote/loconote.js'></script>


</head>
<body style="background-color:rgb(236, 236, 236)">
    <h2>Parent document</h2>
    <p>This page contains a loconote iframe after this paragraph.</p>

    <div id="note-container" style="width:100%;height:70vh"></div>

    <p>Also, above this paragraph.</p>
    <!-- <div>
        <label for="file-selector" class="btn btn-outline-secondary btn-sm">Load from file</label>
        <input class="form-control" type="file" id="file-selector" accept=".loco" style="display:none"/>
        <button id="save-file" class="btn btn-outline-secondary btn-sm">save to file</button>
    </div> -->
    <div>
        Load loconote from file<input class="form-control" type="file" id="file-selector" accept=".loco"/>
    </div>
    <div>
        Save loconote to file <button id="save-file">save</button>
    </div>

    <script>

        function download(data, filename, type) {
            var file = new Blob([data], {type: type});
            
            var a = document.createElement("a"),
                    url = URL.createObjectURL(file);
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            setTimeout(function() {
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);  
            }, 0);
        }

        async function loadNotebook(){

            // fetch content, based on URL search param
            const urlParams = new URLSearchParams(window.location.search);
            const notebookURL = urlParams.get('notebook');
            let notebookResp = await fetch(notebookURL);
            let notebookContent = await notebookResp.text();

            // init notebook
            let notebook = window.Loconote('#note-container', "/loconote/loconote/", notebookContent);

            // handle save button
            document.getElementById("save-file").onclick = async () => {
                let contentObj = await notebook.getContent();
                let content = JSON.stringify( contentObj, null, '\t');
                download( content, "myNotebook.loco", "text/javascript" );
            }

            // handle load file button
            document.getElementById('file-selector').addEventListener('change', (event) => {
                const file = event.target.files[0];
                const reader = new FileReader();
                let content;
                reader.addEventListener('load', () => {
                    content = reader.result;
                    notebook.setContent(content);
                });
                reader.readAsText(file);
            });
        }

        loadNotebook();

    </script>
</body>
</html>